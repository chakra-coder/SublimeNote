{
  "mlq_product": {
    "_parent": {
      "type": "mlq_goods"
    },
    "properties": {
      "product_name": {
        "type": "string",
        "store": "yes",
        "index": "analyzed",
        "analyzer": "ik_analyzer"
      }
    }
  }
}



SELECT mpa1.*,mpa2.addr FROM mlq_product_attr mpa1 LEFT JOIN (SELECT tranAddr(mpa.attr_value,'-') addr,mpa.id FROM mlq_product_attr mpa WHERE mpa.attr_name = '出库地区') mpa2 ON mpa1.id = mpa2.id


{
  "type": "jdbc",
  "jdbc": {
    "url": "jdbc:mysql://localhost:3306/b2b",
    "user": "root",
    "password": "111111",
    "sql": "SELECT mpa1.*,mpa2.addr FROM mlq_product_attr mpa1 LEFT JOIN (SELECT tranAddr(mpa.attr_value,'-') addr,mpa.id as _id FROM mlq_product_attr mpa WHERE mpa.attr_name = '出库地区') mpa2 ON mpa1.id = mpa2.id",
    "index": "b2b",
    "type": "mlq_product_attr"
  }
}


SELECT CASE mpa.attr_name WHEN '出库地区' THEN tranAddr (mpa.attr_value, '-') END AS addr,mpa.id AS _id,mpa.* FROM mlq_product_attr mpa



[
  {
    "bool": {
      "should": [
        {
          "has_child": {
            "type": "mlq_product",
            "query": {
              "range": {
                "mlq_product.product_price": {
                  "from": 2000,
                  "to": 3000
                }
              }
            }
          }
        },
        {
          "range": {
            "sale_price": {
              "from": 2000,
              "to": 3000
            }
          }
        }
      ]
    }
  },
  {
    "bool": {
      "should": [
        {
          "has_child": {
            "type": "mlq_product",
            "query": {
              "term": {
                "mlq_product.product_name_noa": "70#"
              }
            }
          }
        },
        {
          "has_child": {
            "type": "mlq_product_dis",
            "query": {
              "term": {
                "mlq_product_dis.product_name_noa": "SBS"
              }
            }
          }
        }
      ]
    }
  },
  {
    "bool": {
      "should": [
        {
          "has_child": {
            "type": "mlq_product",
            "query": {
              "match": {
                "mlq_product.repository_region_noa": "华北地区"
              }
            }
          }
        },
        {
          "has_child": {
            "type": "mlq_product_dis",
            "query": {
              "term": {
                "mlq_product_dis.repository_region_noa": "华北地区"
              }
            }
          }
        }
      ]
    }
  }
]





{
  "took": 1,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "failed": 0
  },
  "hits": {
    "total": 1,
    "max_score": 1.0,
    "hits": [
      {
        "_index": "b2b",
        "_type": "mlq_goods_dis",
        "_id": "AVNVz3ZQ1j-GBO6UpGU8",
        "_score": 1.0,
        "_source": {
          "id": "201603084JAqCXN",
          "is_distribute": "1",
          "sale_price": "3500.00",
          "goods_id": "20160229g8Y20x1",
          "title": "70#测试沥青-分销",
          "goods_status": "0",
          "category": "沥青,基质沥青,70#",
          "brand_name": "泰普克",
          "brand_name_noa": "泰普克",
          "new_seller_nick": "公诚管理（测试用）",
          "new_seller_nick_noa": "公诚管理（测试用）",
          "cat_code": "20150914q0asfEw,20150914w7L7oG2,201509140732S22,",
          "brand_id": "201509144R1UXp3",
          "goods_model": "70#测试沥青",
          "goods_desc": "",
          "goods_selling_point": "70#测试沥青",
          "is_listing_now": "y",
          "distribution_mode": "1",
          "shop_recommended": "0",
          "weight": "0"
        }
      }
    ]
  }
}