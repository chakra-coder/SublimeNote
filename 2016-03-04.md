### `Elasticsearch`
1. **启动添加内存参数**
```bash
~/opt/elasticsearch-1.7.1/bin/elasticsearch -Xms512m -Xmx1g -d
```
+ **b2b**
```json
curl -XPOST "http://192.168.1.121:9200/b2b" -d'
{
   "settings": {
      "number_of_replicas": "1",
      "number_of_shards": "1"
   },
   "mappings": {
      "mlq_shop_info": {
         "properties": {
            "shop_name": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "shop_desc": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "id": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "shop_logo": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "user_id": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            }
         }
      },
      "mlq_goods": {
         "_parent": {
            "type": "mlq_shop_info"
         },
         "_routing": {
            "required": true
         },
         "properties": {
            "audit_remark": {
               "type": "string"
            },
            "brand_id": {
               "type": "string"
            },
            "brand_name": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "brand_name_noa": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "cat_code": {
               "type": "string",
               "store": true,
               "analyzer": "mmseg"
            },
            "category": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "distribution_mode": {
               "type": "long"
            },
            "gmt_create": {
               "type": "date",
               "format": "dateOptionalTime"
            },
            "gmt_listing": {
               "type": "date",
               "format": "dateOptionalTime"
            },
            "gmt_modify": {
               "type": "date",
               "format": "dateOptionalTime"
            },
            "goods_desc": {
               "type": "string"
            },
            "goods_model": {
               "type": "string"
            },
            "goods_number": {
               "type": "string"
            },
            "goods_price": {
               "type": "string"
            },
            "goods_selling_point": {
               "type": "string"
            },
            "goods_status": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "id": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "img_large": {
               "type": "string"
            },
            "is_listing_now": {
               "type": "string"
            },
            "is_self": {
               "type": "long"
            },
            "logistics_type": {
               "type": "long"
            },
            "new_seller_nick": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "new_seller_nick_noa": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "search_tag": {
               "type": "string"
            },
            "seller_id": {
               "type": "string"
            },
            "seller_nick": {
               "type": "string"
            },
            "shop_cat_id": {
               "type": "string"
            },
            "shop_id": {
               "type": "string"
            },
            "shop_recommended": {
               "type": "long"
            },
            "sort": {
               "type": "long"
            },
            "title": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "weight": {
               "type": "long"
            }
         }
      },
      "mlq_goods_dis": {
         "_parent": {
            "type": "mlq_shop_info"
         },
         "_routing": {
            "required": true
         },
         "properties": {
            "audit_remark": {
               "type": "string"
            },
            "brand_id": {
               "type": "string"
            },
            "brand_name": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "brand_name_noa": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "cat_code": {
               "type": "string",
               "store": true,
               "analyzer": "mmseg"
            },
            "category": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "distribution_mode": {
               "type": "long"
            },
            "goods_desc": {
               "type": "string"
            },
            "goods_model": {
               "type": "string"
            },
            "goods_selling_point": {
               "type": "string"
            },
            "goods_status": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "id": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "goods_id": {   
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "is_listing_now": {
               "type": "string"
            },
            "is_self": {
               "type": "long"
            },
            "new_seller_nick": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "new_seller_nick_noa": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "shop_id": {
               "type": "string"
            },
            "shop_recommended": {
               "type": "long"
            },
            "sort": {
               "type": "long"
            },
            "weight": {
               "type": "long"
            },
            "title": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "sale_price": {
               "type": "double"
            }
         }
      },
      "mlq_product_dis": {
         "_parent": {
            "type": "mlq_goods_dis"
         },
         "_routing": {
            "required": true
         },
         "properties": {
            "delivery_day": {
               "type": "string"
            },
            "goods_id": {
               "type": "string"
            },
            "id": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "min_quantity": {
               "type": "string"
            },
            "package_type": {
               "type": "string"
            },
            "product_id": {
               "type": "string"
            },
            "product_name": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "product_name_noa": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "repository_region": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "repository_region_noa": {
               "type": "string",
               "store": true,
               "analyzer": "simple"
            },
            "repository_region_simple": {
               "type": "string",
               "store": true,
               "analyzer": "simple"
            },
            "sale_region": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "stock_quantity": {
               "type": "string"
            },
            "unit": {
               "type": "string"
            }
         }
      },
      "mlq_product": {
         "_parent": {
            "type": "mlq_goods"
         },
         "_routing": {
            "required": true
         },
         "properties": {
            "brand_price": {
               "type": "double"
            },
            "contract_id": {
               "type": "string"
            },
            "creater": {
               "type": "string"
            },
            "delivery_day": {
               "type": "string"
            },
            "gmt_create": {
               "type": "date",
               "format": "dateOptionalTime"
            },
            "gmt_modify": {
               "type": "date",
               "format": "dateOptionalTime"
            },
            "goods_id": {
               "type": "string"
            },
            "id": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "min_quantity": {
               "type": "string"
            },
            "package_type": {
               "type": "string"
            },
            "product_id": {
               "type": "string"
            },
            "product_name": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "product_name_noa": {
               "type": "string",
               "index": "not_analyzed",
               "store": true
            },
            "product_price": {
               "type": "double"
            },
            "repository_region": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "repository_region_noa": {
               "type": "string",
               "store": true,
               "analyzer": "simple"
            },
            "repository_region_simple": {
               "type": "string",
               "store": true,
               "analyzer": "simple"
            },
            "sale_region": {
               "type": "string",
               "store": true,
               "analyzer": "ik"
            },
            "stock_quantity": {
               "type": "string"
            },
            "unit": {
               "type": "string"
            }
         }
      }
   }
}'
```

+ **tmp-b2b**
```json
{
   "from": 0,
   "size": 10,
   "query": {
      "function_score": {
         "query": {
            "bool": {
               "must": [
                  {
                     "multi_match": {
                        "query": "夏邑县乐晒防水涂料销售部",
                        "fields": [
                           "new_seller_nick",
                           "brand_name",
                           "title"
                        ]
                     }
                  },
                  {
                     "match": {
                        "cat_code": "23245asdf"
                     }
                  },
                  {
                     "term": {
                        "new_seller_nick_noa": "中物振华"
                     }
                  },
                  {
                     "match": {
                        "shop_id": "seefwefwef"
                     }
                  },
                  {
                     "match": {
                        "shop_cat": "xxxeewef333"
                     }
                  },
                  {
                     "term": {
                        "brand_name_noa": "国产"
                     }
                  },
                  {
                     "term": {
                        "goods_status": "c"
                     }
                  },
                  {
                     "bool": {
                        "should": [
                           {
                              "has_child": {
                                 "type": "mlq_product",
                                 "query": {
                                    "range": {
                                       "mlq_product.product_price": {
                                          "from": 2000,
                                          "to": 3000
                                       }
                                    }
                                 }
                              }
                           },
                           {
                               "range": {
                                  "sale_price": {
                                     "from": 2000,
                                     "to": 3000
                                  }
                               }
                           }
                        ]
                     }
                  },
                  {
                     "bool": {
                        "should": [
                           {
                              "has_child": {
                                 "type": "mlq_product",
                                 "query": {
                                    "term": {
                                       "mlq_product.product_name_noa": "70#"
                                    }
                                 }
                              }
                           },
                           {
                              "has_child": {
                                 "type": "mlq_product_dis",
                                 "query": {
                                    "term": {
                                       "mlq_product_dis.product_name_noa": "SBS"
                                    }
                                 }
                              }
                           }
                        ]
                     }
                  },
                  {
                     "bool": {
                        "should": [
                           {
                              "has_child": {
                                 "type": "mlq_product",
                                 "query": {
                                    "match": {
                                       "mlq_product.repository_region_noa": "华北地区"
                                    }
                                 }
                              }
                           },
                           {
                              "has_child": {
                                 "type": "mlq_product_dis",
                                 "query": {
                                    "term": {
                                       "mlq_product_dis.repository_region_noa": "华北地区"
                                    }
                                 }
                              }
                           }
                        ]
                     }
                  },
                  {
                     "has_parent": {
                        "parent_type": "mlq_shop_info",
                        "score_type": "score",
                        "query": {
                           "function_score": {
                              "functions": [
                                 {
                                    "script_score": {
                                       "script": "doc['mlq_shop_info.weight'].value*0.02"
                                    }
                                 }
                              ],
                              "query": {
                                 "match_all": {}
                              },
                              "boost_mode": "replace"
                           }
                        }
                     }
                  }
               ]
            }
         },
         "functions": [
            {
               "script_score": {
                  "script": "doc['mlq_goods.weight'].value*0.01"
               }
            }
         ],
         "score_mode": "sum",
         "boost_mode": "sum"
      }
   },
   "aggs": {
      "brand_names": {
         "terms": {
            "field": "brand_name_noa",
            "size": 20
         }
      },
      "seller_nicks": {
         "terms": {
            "field": "new_seller_nick_noa",
            "size": 20
         }
      },
      "product_names": {
         "children": {
            "type": "mlq_product"
         },
         "aggs": {
            "tops": {
               "terms": {
                  "field": "product_name_noa",
                  "size": 20
               }
            }
         }
      }
   }
}
```
+ **tmp**
```
curl -XGET "http://192.168.1.121:9200/b2b/mlq_product/_search"
```

### `Linux`
#### `iptables`
1 **打开80端口**
```bash
#打开主动模式21端口
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
```

+ **注册service服务**
```
service 操作的命令 相当于在 /etc/init.d/目录下的命令
```